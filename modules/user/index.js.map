{"version":3,"sources":["modules/user/index.js"],"names":["symbols","calculateStatus","state","accountInfo","status","accountInfoStatus","fetching","extensionInfo","extensionInfoStatus","dialingPlan","dialingPlanStatus","phoneNumber","extensionPhoneNumberStatus","forwardingNumber","forwardingNumberStatus","blockedNumber","blockedNumberStatus","pending","ready","User","options","api","auth","storage","getState","reducer","on","oldState","newState","oldStatus","newStatus","emit","statusChange","accountInfoEvents","error","extensionInfoEvents","dialingPlanEvents","extensionPhoneNumberEvents","forwardingNumberEvents","blockedNumberEvents"],"mappings":"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","file":"index.js","sourcesContent":["import SymbolMap from 'data-types/symbol-map';\nimport { combineReducers } from 'redux';\nimport RcModule, { addModule } from '../../lib/rc-module';\nimport userStatus from './user-status';\nimport userEvents from './user-events';\n\nimport AccountInfo from '../account-info';\nimport ExtensionInfo from '../extension-info';\nimport DialingPlan from '../dialing-plan';\nimport ExtensionPhoneNumber from '../extension-phone-number';\nimport ForwardingNumber from '../forwarding-number';\nimport BlockedNumber from '../blocked-number';\n\nconst symbols = new SymbolMap([\n  'api',\n  'auth',\n  'storage',\n  'reducer',\n]);\n\nfunction calculateStatus(state) {\n  if (\n    state.accountInfo.status === AccountInfo.accountInfoStatus.fetching ||\n    state.extensionInfo.status === ExtensionInfo.extensionInfoStatus.fetching ||\n    state.dialingPlan.status === DialingPlan.dialingPlanStatus.fetching ||\n    state.phoneNumber.status === ExtensionPhoneNumber.extensionPhoneNumberStatus.fetching ||\n    state.forwardingNumber.status === ForwardingNumber.forwardingNumberStatus.fetching ||\n    state.blockedNumber.status === BlockedNumber.blockedNumberStatus.fetching\n  ) {\n    return userStatus.fetching;\n  } else if (\n    state.accountInfo.status === AccountInfo.accountInfoStatus.pending ||\n    state.extensionInfo.status === ExtensionInfo.extensionInfoStatus.pending ||\n    state.dialingPlan.status === DialingPlan.dialingPlanStatus.pending ||\n    state.phoneNumber.status === ExtensionPhoneNumber.extensionPhoneNumberStatus.pending ||\n    state.forwardingNumber.status === ForwardingNumber.forwardingNumberStatus.pending ||\n    state.blockedNumber.status === BlockedNumber.blockedNumberStatus.pending\n  ) {\n    return userStatus.pending;\n  }\n  return userStatus.ready;\n}\n\nexport default class User extends RcModule {\n  constructor(options = {}) {\n    super({\n      ...options,\n    });\n\n    const {\n      api,\n      auth,\n      storage,\n    } = options;\n    this[symbols.api] = api;\n    this[symbols.auth] = auth;\n    this[symbols.storage] = storage;\n\n    this::addModule('accountInfo', new AccountInfo({\n      ...options,\n      getState: () => this.state.accountInfo,\n    }));\n    this::addModule('extensionInfo', new ExtensionInfo({\n      ...options,\n      getState: () => this.state.extensionInfo,\n    }));\n    this::addModule('dialingPlan', new DialingPlan({\n      ...options,\n      getState: () => this.state.dialingPlan,\n    }));\n    this::addModule('phoneNumber', new ExtensionPhoneNumber({\n      ...options,\n      getState: () => this.state.phoneNumber,\n    }));\n    this::addModule('forwardingNumber', new ForwardingNumber({\n      ...options,\n      getState: () => this.state.forwardingNumber,\n    }));\n    this::addModule('blockedNumber', new BlockedNumber({\n      ...options,\n      getState: () => this.state.blockedNumber,\n    }));\n\n    this[symbols.reducer] = combineReducers({\n      accountInfo: this.accountInfo.reducer,\n      extensionInfo: this.extensionInfo.reducer,\n      dialingPlan: this.dialingPlan.reducer,\n      phoneNumber: this.phoneNumber.reducer,\n      forwardingNumber: this.forwardingNumber.reducer,\n      blockedNumber: this.blockedNumber.reducer,\n    });\n\n    this.on('state-change', ({ oldState, newState }) => {\n      const oldStatus = oldState && calculateStatus(oldState);\n      const newStatus = calculateStatus(newState);\n      if (oldStatus !== newStatus) {\n        this.emit(userEvents.statusChange, {\n          oldStatus,\n          newStatus,\n        });\n        this.emit(newStatus);\n      }\n    });\n    this.accountInfo.on(this.accountInfo.accountInfoEvents.error, error => {\n      this.emit(userEvents.error, error);\n    });\n    this.extensionInfo.on(this.extensionInfo.extensionInfoEvents.error, error => {\n      this.emit(userEvents.error, error);\n    });\n    this.dialingPlan.on(this.dialingPlan.dialingPlanEvents.error, error => {\n      this.emit(userEvents.error, error);\n    });\n    this.phoneNumber.on(this.phoneNumber.extensionPhoneNumberEvents.error, error => {\n      this.emit(userEvents.error, error);\n    });\n    this.forwardingNumber.on(this.forwardingNumber.forwardingNumberEvents.error, error => {\n      this.emit(userEvents.error, error);\n    });\n    this.blockedNumber.on(this.blockedNumber.blockedNumberEvents.error, error => {\n      this.emit(userEvents.error, error);\n    });\n  }\n\n  get userStatus() {\n    return userStatus;\n  }\n  static get userStatus() {\n    return userStatus;\n  }\n\n  get userEvents() {\n    return userEvents;\n  }\n  static get userEvents() {\n    return userEvents;\n  }\n\n  get reducer() {\n    return this[symbols.reducer];\n  }\n\n  get status() {\n    return calculateStatus(this.state);\n  }\n}\n"]}