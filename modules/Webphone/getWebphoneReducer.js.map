{"version":3,"sources":["modules/Webphone/getWebphoneReducer.js"],"names":["getVideoElementPreparedReducer","getConnectionStatusReducer","getErrorCodeReducer","getConnectRetryCountsReducer","getActiveSessionIdReducer","getRingSessionIdReducer","getLastEndedSessionsReducer","getSessionsReducer","getWebphoneReducer","types","state","type","videoElementPrepared","disconnected","connect","reconnect","connecting","registered","connected","unregistered","disconnect","disconnecting","connectError","registrationFailed","connectFailed","errorCode","resetRetryCounts","session","sessions","onHoldSessions","callStart","id","callEnd","filter","sessionItem","ringSessions","callRing","lastSessions","startTime","isToVoicemail","isForwarded","isReplied","concat","slice","updateSessions","destroySessions","status","connectionStatus","connectRetryCounts","activeSessionId","ringSessionId","lastEndedSessions"],"mappings":";;;;;QAKgBA,8B,GAAAA,8B;QAOAC,0B,GAAAA,0B;QAqBAC,mB,GAAAA,mB;QAcAC,4B,GAAAA,4B;QAcAC,yB,GAAAA,yB;QAwBAC,uB,GAAAA,uB;QAyBAC,2B,GAAAA,2B;QA2BAC,kB,GAAAA,kB;kBAaQC,kB;;AAtJxB;;AACA;;;;AACA;;;;AACA;;;;AAEO,SAASR,8BAAT,CAAwCS,KAAxC,EAA+C;AACpD,SAAO,YAA6B;AAAA,QAA5BC,KAA4B,uEAApB,KAAoB;AAAA;AAAA,QAAXC,IAAW,QAAXA,IAAW;;AAClC,QAAIA,SAASF,MAAMG,oBAAnB,EAAyC,OAAO,IAAP;AACzC,WAAOF,KAAP;AACD,GAHD;AAID;;AAEM,SAAST,0BAAT,CAAoCQ,KAApC,EAA2C;AAChD,SAAO,YAAqD;AAAA,QAApDC,KAAoD,uEAA5C,2BAAiBG,YAA2B;AAAA;AAAA,QAAXF,IAAW,SAAXA,IAAW;;AAC1D,YAAQA,IAAR;AACE,WAAKF,MAAMK,OAAX;AACA,WAAKL,MAAMM,SAAX;AACE,eAAO,2BAAiBC,UAAxB;AACF,WAAKP,MAAMQ,UAAX;AACE,eAAO,2BAAiBC,SAAxB;AACF,WAAKT,MAAMU,YAAX;AACE,eAAO,2BAAiBN,YAAxB;AACF,WAAKJ,MAAMW,UAAX;AACE,eAAO,2BAAiBC,aAAxB;AACF,WAAKZ,MAAMa,YAAX;AACA,WAAKb,MAAMc,kBAAX;AACE,eAAO,2BAAiBC,aAAxB;AACF;AACE,eAAOd,KAAP;AAdJ;AAgBD,GAjBD;AAkBD;;AAEM,SAASR,mBAAT,CAA6BO,KAA7B,EAAoC;AACzC,SAAO,YAA+C;AAAA,QAA9CC,KAA8C,uEAAtC,IAAsC;AAAA;AAAA,QAA9BC,IAA8B,SAA9BA,IAA8B;AAAA,gCAAxBc,SAAwB;AAAA,QAAxBA,SAAwB,mCAAZf,KAAY;;AACpD,YAAQC,IAAR;AACE,WAAKF,MAAMa,YAAX;AACA,WAAKb,MAAMc,kBAAX;AACE,eAAOE,SAAP;AACF,WAAKhB,MAAMQ,UAAX;AACE,eAAO,IAAP;AACF;AACE,eAAOP,KAAP;AAPJ;AASD,GAVD;AAWD;;AAEM,SAASP,4BAAT,CAAsCM,KAAtC,EAA6C;AAClD,SAAO,YAAyB;AAAA,QAAxBC,KAAwB,uEAAhB,CAAgB;AAAA;AAAA,QAAXC,IAAW,SAAXA,IAAW;;AAC9B,YAAQA,IAAR;AACE,WAAKF,MAAMM,SAAX;AACE,eAAOL,QAAQ,CAAf;AACF,WAAKD,MAAMiB,gBAAX;AACA,WAAKjB,MAAMQ,UAAX;AACE,eAAO,CAAP;AACF;AACE,eAAOP,KAAP;AAPJ;AASD,GAVD;AAWD;;AAEM,SAASN,yBAAT,CAAmCK,KAAnC,EAA0C;AAC/C,SAAO,YAAyD;AAAA,QAAxDC,KAAwD,uEAAhD,IAAgD;AAAA;AAAA,QAAxCC,IAAwC,SAAxCA,IAAwC;AAAA,8BAAlCgB,OAAkC;AAAA,QAAlCA,OAAkC,iCAAxB,EAAwB;AAAA,+BAApBC,QAAoB;AAAA,QAApBA,QAAoB,kCAAT,EAAS;;AAC9D,QAAIC,uBAAJ;AACA,YAAQlB,IAAR;AACE,WAAKF,MAAMqB,SAAX;AACE,eAAOH,QAAQI,EAAf;AACF,WAAKtB,MAAMuB,OAAX;AACE,YAAIL,QAAQI,EAAR,KAAerB,KAAnB,EAA0B;AACxB,iBAAOA,KAAP;AACD;AACDmB,yBACED,SAASK,MAAT,CAAgB;AAAA,iBAAe,8BAASC,WAAT,CAAf;AAAA,SAAhB,CADF;AAEA,YAAIL,kBAAkBA,eAAe,CAAf,CAAtB,EAAyC;AACvC,iBAAOA,eAAe,CAAf,EAAkBE,EAAzB;AACD;AACD,eAAO,IAAP;AACF,WAAKtB,MAAMW,UAAX;AACE,eAAO,IAAP;AACF;AACE,eAAOV,KAAP;AAhBJ;AAkBD,GApBD;AAqBD;;AAEM,SAASL,uBAAT,CAAiCI,KAAjC,EAAwC;AAC7C,SAAO,YAAyD;AAAA,QAAxDC,KAAwD,uEAAhD,IAAgD;AAAA;AAAA,QAAxCC,IAAwC,SAAxCA,IAAwC;AAAA,8BAAlCgB,OAAkC;AAAA,QAAlCA,OAAkC,iCAAxB,EAAwB;AAAA,+BAApBC,QAAoB;AAAA,QAApBA,QAAoB,kCAAT,EAAS;;AAC9D,QAAIO,qBAAJ;AACA,YAAQxB,IAAR;AACE,WAAKF,MAAM2B,QAAX;AACE,eAAOT,QAAQI,EAAf;AACF,WAAKtB,MAAMqB,SAAX;AACA,WAAKrB,MAAMuB,OAAX;AACE,YAAIL,QAAQI,EAAR,KAAerB,KAAnB,EAA0B;AACxB,iBAAOA,KAAP;AACD;AACDyB,uBACEP,SAASK,MAAT,CAAgB;AAAA,iBAAe,4BAAOC,WAAP,CAAf;AAAA,SAAhB,CADF;AAEA,YAAIC,gBAAgBA,aAAa,CAAb,CAApB,EAAqC;AACnC,iBAAOA,aAAa,CAAb,EAAgBJ,EAAvB;AACD;AACD,eAAO,IAAP;AACF,WAAKtB,MAAMW,UAAX;AACE,eAAO,IAAP;AACF;AACE,eAAOV,KAAP;AAjBJ;AAmBD,GArBD;AAsBD;;AAEM,SAASJ,2BAAT,CAAqCG,KAArC,EAA4C;AACjD,SAAO,YAAwC;AAAA,QAAvCC,KAAuC,uEAA/B,EAA+B;AAAA;AAAA,QAAzBC,IAAyB,SAAzBA,IAAyB;AAAA,8BAAnBgB,OAAmB;AAAA,QAAnBA,OAAmB,iCAAT,EAAS;;AAC7C,QAAIU,qBAAJ;AACA,YAAQ1B,IAAR;AACE,WAAKF,MAAMuB,OAAX;AACE;AACE;;;;AAIA,SAACL,QAAQW,SAAT,IACA,CAACX,QAAQY,aADT,IAEA,CAACZ,QAAQa,WAFT,IAGA,CAACb,QAAQc,SARX,EASE;AACA,iBAAO/B,KAAP;AACD;AACD2B,uBAAe,CAACV,OAAD,EAAUe,MAAV,CACbhC,MAAMuB,MAAN,CAAa;AAAA,iBAAeC,YAAYH,EAAZ,KAAmBJ,QAAQI,EAA1C;AAAA,SAAb,CADa,CAAf;AAGA,eAAOM,aAAaM,KAAb,CAAmB,CAAnB,EAAsB,CAAtB,CAAP;AACF;AACE,eAAOjC,KAAP;AAnBJ;AAqBD,GAvBD;AAwBD;;AAEM,SAASH,kBAAT,CAA4BE,KAA5B,EAAmC;AACxC,SAAO,YAAoC;AAAA,QAAnCC,KAAmC,uEAA3B,EAA2B;AAAA;AAAA,QAArBC,IAAqB,SAArBA,IAAqB;AAAA,QAAfiB,QAAe,SAAfA,QAAe;;AACzC,YAAQjB,IAAR;AACE,WAAKF,MAAMmC,cAAX;AACE,eAAOhB,QAAP;AACF,WAAKnB,MAAMoC,eAAX;AACE,eAAO,EAAP;AACF;AACE,eAAOnC,KAAP;AANJ;AAQD,GATD;AAUD;;AAEc,SAASF,kBAAT,CAA4BC,KAA5B,EAAmC;AAChD,SAAO,4BAAgB;AACrBqC,YAAQ,sCAAuBrC,KAAvB,CADa;AAErBG,0BAAsBZ,+BAA+BS,KAA/B,CAFD;AAGrBsC,sBAAkB9C,2BAA2BQ,KAA3B,CAHG;AAIrBuC,wBAAoB7C,6BAA6BM,KAA7B,CAJC;AAKrBgB,eAAWvB,oBAAoBO,KAApB,CALU;AAMrBwC,qBAAiB7C,0BAA0BK,KAA1B,CANI;AAOrByC,mBAAe7C,wBAAwBI,KAAxB,CAPM;AAQrBmB,cAAUrB,mBAAmBE,KAAnB,CARW;AASrB0C,uBAAmB7C,4BAA4BG,KAA5B;AATE,GAAhB,CAAP;AAWD","file":"getWebphoneReducer.js","sourcesContent":["import { combineReducers } from 'redux';\nimport getModuleStatusReducer from '../../lib/getModuleStatusReducer';\nimport connectionStatus from './connectionStatus';\nimport { isRing, isOnHold } from './webphoneHelper';\n\nexport function getVideoElementPreparedReducer(types) {\n  return (state = false, { type }) => {\n    if (type === types.videoElementPrepared) return true;\n    return state;\n  };\n}\n\nexport function getConnectionStatusReducer(types) {\n  return (state = connectionStatus.disconnected, { type }) => {\n    switch (type) {\n      case types.connect:\n      case types.reconnect:\n        return connectionStatus.connecting;\n      case types.registered:\n        return connectionStatus.connected;\n      case types.unregistered:\n        return connectionStatus.disconnected;\n      case types.disconnect:\n        return connectionStatus.disconnecting;\n      case types.connectError:\n      case types.registrationFailed:\n        return connectionStatus.connectFailed;\n      default:\n        return state;\n    }\n  };\n}\n\nexport function getErrorCodeReducer(types) {\n  return (state = null, { type, errorCode = state }) => {\n    switch (type) {\n      case types.connectError:\n      case types.registrationFailed:\n        return errorCode;\n      case types.registered:\n        return null;\n      default:\n        return state;\n    }\n  };\n}\n\nexport function getConnectRetryCountsReducer(types) {\n  return (state = 0, { type }) => {\n    switch (type) {\n      case types.reconnect:\n        return state + 1;\n      case types.resetRetryCounts:\n      case types.registered:\n        return 0;\n      default:\n        return state;\n    }\n  };\n}\n\nexport function getActiveSessionIdReducer(types) {\n  return (state = null, { type, session = {}, sessions = [] }) => {\n    let onHoldSessions;\n    switch (type) {\n      case types.callStart:\n        return session.id;\n      case types.callEnd:\n        if (session.id !== state) {\n          return state;\n        }\n        onHoldSessions =\n          sessions.filter(sessionItem => isOnHold(sessionItem));\n        if (onHoldSessions && onHoldSessions[0]) {\n          return onHoldSessions[0].id;\n        }\n        return null;\n      case types.disconnect:\n        return null;\n      default:\n        return state;\n    }\n  };\n}\n\nexport function getRingSessionIdReducer(types) {\n  return (state = null, { type, session = {}, sessions = [] }) => {\n    let ringSessions;\n    switch (type) {\n      case types.callRing:\n        return session.id;\n      case types.callStart:\n      case types.callEnd:\n        if (session.id !== state) {\n          return state;\n        }\n        ringSessions =\n          sessions.filter(sessionItem => isRing(sessionItem));\n        if (ringSessions && ringSessions[0]) {\n          return ringSessions[0].id;\n        }\n        return null;\n      case types.disconnect:\n        return null;\n      default:\n        return state;\n    }\n  };\n}\n\nexport function getLastEndedSessionsReducer(types) {\n  return (state = [], { type, session = {} }) => {\n    let lastSessions;\n    switch (type) {\n      case types.callEnd:\n        if (\n          /**\n          * don't add incoming call that isn't relied by current app\n          *   to end sessions. this call can be answered by other apps\n          */\n          !session.startTime &&\n          !session.isToVoicemail &&\n          !session.isForwarded &&\n          !session.isReplied\n        ) {\n          return state;\n        }\n        lastSessions = [session].concat(\n          state.filter(sessionItem => sessionItem.id !== session.id)\n        );\n        return lastSessions.slice(0, 5);\n      default:\n        return state;\n    }\n  };\n}\n\nexport function getSessionsReducer(types) {\n  return (state = [], { type, sessions }) => {\n    switch (type) {\n      case types.updateSessions:\n        return sessions;\n      case types.destroySessions:\n        return [];\n      default:\n        return state;\n    }\n  };\n}\n\nexport default function getWebphoneReducer(types) {\n  return combineReducers({\n    status: getModuleStatusReducer(types),\n    videoElementPrepared: getVideoElementPreparedReducer(types),\n    connectionStatus: getConnectionStatusReducer(types),\n    connectRetryCounts: getConnectRetryCountsReducer(types),\n    errorCode: getErrorCodeReducer(types),\n    activeSessionId: getActiveSessionIdReducer(types),\n    ringSessionId: getRingSessionIdReducer(types),\n    sessions: getSessionsReducer(types),\n    lastEndedSessions: getLastEndedSessionsReducer(types),\n  });\n}\n"]}