{"version":3,"sources":["modules/index.js"],"names":["actionTypes","getEventReducer","types","state","type","event","args","getStatusReducer","pending","init","ready","getActiveReducer","active","mainTabIdChanged","getTabManagerReducer","status","TabManager","options","_tabbie","prefix","_reducer","store","getIsMain","dispatch","enabled","on","mainTabId","send"],"mappings":"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","file":"index.js","sourcesContent":["import RcModule from 'ringcentral-integration/lib/RcModule';\nimport Enum from 'ringcentral-integration/lib/Enum';\nimport { combineReducers } from 'redux';\nimport Tabbie from '../../lib/Tabbie';\nimport moduleStatus from '../../enums/moduleStatus';\n\nconst actionTypes = new Enum([\n  'init',\n  'mainTabIdChanged',\n  'event',\n], 'active-tab');\n\nfunction getEventReducer(types) {\n  return (state = null, { type, event, args }) => {\n    if (type === types.event) {\n      return {\n        event,\n        args,\n      };\n    }\n    return null;\n  };\n}\n\nfunction getStatusReducer(types) {\n  return (state = moduleStatus.pending, { type }) => {\n    switch (type) {\n      case types.init:\n        return moduleStatus.ready;\n      default:\n        return state;\n    }\n  };\n}\nfunction getActiveReducer(types) {\n  return (state = false, { type, active }) => {\n    switch (type) {\n      case types.init:\n      case types.mainTabIdChanged:\n        return active;\n      default:\n        return state;\n    }\n  };\n}\n\nfunction getTabManagerReducer(types) {\n  return combineReducers({\n    status: getStatusReducer(types),\n    active: getActiveReducer(types),\n    event: getEventReducer(types),\n  });\n}\n\nexport default class TabManager extends RcModule {\n  constructor({\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._tabbie = new Tabbie({\n      prefix: this.prefix,\n    });\n    this._reducer = getTabManagerReducer(this.actionTypes);\n  }\n  async initialize() {\n    this.store.dispatch({\n      type: this.actionTypes.init,\n      active: await this._tabbie.getIsMain(),\n    });\n    if (this._tabbie.enabled) {\n      this._tabbie.on('mainTabIdChanged', async mainTabId => {\n        this.store.dispatch({\n          type: this.actionTypes.mainTabIdChanged,\n          mainTabId,\n          active: await this._tabbie.getIsMain(),\n        });\n      });\n      this._tabbie.on('event', (event, ...args) => {\n        this.store.dispatch({\n          type: this.actionTypes.event,\n          event,\n          args,\n        });\n      });\n    }\n  }\n\n  send(event, ...args) {\n    this._tabbie.send(event, ...args);\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get pending() {\n    return this.state.status === moduleStatus.pending;\n  }\n\n  get ready() {\n    return this.state.status === moduleStatus.ready;\n  }\n\n  get active() {\n    return this.state.active;\n  }\n\n  get event() {\n    return this.state.event;\n  }\n}\n"]}