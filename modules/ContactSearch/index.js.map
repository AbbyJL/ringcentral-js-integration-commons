{"version":3,"sources":["modules/ContactSearch/index.js"],"names":["uniqueContactItems","sortContactItemsByName","groupByFirstLetterOfName","AllContactSourceName","DefaultMinimalSearchLength","DefaultContactListPageSize","result","items","filter","value","index","arr","indexOf","hash","unique","forEach","item","itemId","type","id","push","sort","a","b","name1","name","toLowerCase","replace","name2","isNumber1","test","isNumber2","localeCompare","contactItems","groups","length","group","contact","letter","toLocaleUpperCase","caption","contacts","ContactSearch","auth","storage","storageKey","minimalSearchLength","contactListPageSize","ttl","options","actionTypes","_auth","_storage","_storageKey","_minimalSearchLength","_contactListPageSize","_ttl","_searchSources","_searchSourcesFormat","_searchSourcesCheck","_reducer","registerReducer","key","reducer","cache","addSelector","size","names","keys","sourceName","searching","pageSize","pageNumber","searchCriteria","count","slice","store","subscribe","_onStateChange","_shouldInit","_initModuleStatus","_shouldReset","_resetModuleStatus","_clearStateCache","loginStatus","loggedIn","ready","_readyCheck","dispatch","initSuccess","cleanUp","resetSuccess","searchFn","readyCheckFn","formatFn","Error","has","set","searchString","prepareSearch","searchOnSources","_searchSource","searchText","updateSearchCriteria","clearTimeout","_searchTimeoutId","setTimeout","source","search","entities","_searchFromCache","_loadSearching","get","_saveSearching","_onSearchError","contactSearch","now","Date","timestamp","searchError","searchSuccess","save","getItem","state","status","searchStatus","_selectors","contactSourceNames","contactGroups"],"mappings":"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","file":"index.js","sourcesContent":["import RcModule from '../../lib/RcModule';\nimport loginStatus from '../../modules/Auth/loginStatus';\nimport proxify from '../../lib/proxy/proxify';\n\nimport actionTypes from './actionTypes';\nimport getContactSearchReducer from './getContactSearchReducer';\nimport getCacheReducer from './getCacheReducer';\n\nexport const AllContactSourceName = 'all';\nexport const DefaultMinimalSearchLength = 3;\nexport const DefaultContactListPageSize = 20;\n\nexport function uniqueContactItems(result) {\n  let items = result || [];\n  // remove duplicated referencing\n  items = items.filter((value, index, arr) =>\n    arr.indexOf(value) === index\n  );\n  // remove duplicated items by id\n  const hash = {};\n  const unique = [];\n  items.forEach((item) => {\n    const itemId = `${item.type}${item.id}`;\n    if (!hash[itemId]) {\n      hash[itemId] = 1;\n      unique.push(item);\n    }\n  });\n  return unique;\n}\n\nexport function sortContactItemsByName(result) {\n  const items = result || [];\n  items.sort((a, b) => {\n    const name1 = (a.name || '').toLowerCase().replace(/^\\s\\s*/, ''); // trim start\n    const name2 = (b.name || '').toLowerCase().replace(/^\\s\\s*/, ''); // trim start\n    const isNumber1 = /^[0-9]/.test(name1);\n    const isNumber2 = /^[0-9]/.test(name2);\n    if (isNumber1 && isNumber2) {\n      return name1.localeCompare(name2);\n    } else if (isNumber1 || isNumber2) {\n      // put number name at last\n      return -name1.localeCompare(name2);\n    }\n    return name1.localeCompare(name2);\n  });\n  return items;\n}\n\nexport function groupByFirstLetterOfName(contactItems) {\n  const groups = [];\n  if (contactItems && contactItems.length) {\n    let group;\n    contactItems.forEach((contact) => {\n      const name = (contact.name || '').replace(/^\\s\\s*/, ''); // trim start\n      const letter = (name[0] || '').toLocaleUpperCase();\n      if (!group || group.caption !== letter) {\n        group = {\n          contacts: [],\n          caption: letter,\n          id: letter,\n        };\n        groups.push(group);\n      }\n      group.contacts.push(contact);\n    });\n  }\n  return groups;\n}\n\n/**\n * @class\n * @description Contact search module\n */\nexport default class ContactSearch extends RcModule {\n  /**\n   * @constructor\n   * @param {Object} params - params object\n   * @param {Auth} params.auth - auth module instance\n   * @param {Storage} params.storage - storage module instance\n   * @param {String} params.storageKey - storage key for storage module default \"contactSearchCache\"\n   * @param {Number} params.minimalSearchLength - minimal search text length, default 3 characters\n   * @param {Number} params.ttl - timestamp of local cache, default 5 mins\n   */\n  constructor({\n    auth,\n    storage,\n    storageKey = 'contactSearchCache',\n    minimalSearchLength = DefaultMinimalSearchLength,\n    contactListPageSize = DefaultContactListPageSize,\n    ttl = 5 * 60 * 1000, // 5 minutes\n    ...options,\n  }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._auth = auth;\n    this._storage = storage;\n    this._storageKey = storageKey;\n    this._minimalSearchLength = minimalSearchLength;\n    this._contactListPageSize = contactListPageSize;\n    this._ttl = ttl;\n    this._searchSources = new Map();\n    this._searchSourcesFormat = new Map();\n    this._searchSourcesCheck = new Map();\n    if (this._storage) {\n      this._reducer = getContactSearchReducer(this.actionTypes);\n      this._storage.registerReducer({\n        key: this._storageKey,\n        reducer: getCacheReducer(this.actionTypes)\n      });\n    } else {\n      this._reducer = getContactSearchReducer(this.actionTypes, {\n        cache: getCacheReducer(this.actionTypes),\n      });\n    }\n\n    this.addSelector(\n      'contactSourceNames',\n      () => this._searchSources.size,\n      () => {\n        const names = [AllContactSourceName];\n        for (const sourceName of this._searchSources.keys()) {\n          names.push(sourceName);\n        }\n        return names;\n      }\n    );\n\n    this.addSelector(\n      'contactGroups',\n      () => this.searching && this.searching.result,\n      (result) => {\n        const pageSize = this._contactListPageSize;\n        const pageNumber = this.searchCriteria.pageNumber || 1;\n        const count = pageNumber * pageSize;\n        let items = uniqueContactItems(result);\n        items = sortContactItemsByName(items);\n        items = items.slice(0, count);\n        const groups = groupByFirstLetterOfName(items);\n        return groups;\n      }\n    );\n  }\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  _onStateChange() {\n    if (this._shouldInit()) {\n      this._initModuleStatus();\n    } else if (this._shouldReset()) {\n      this._resetModuleStatus();\n      this._clearStateCache();\n    }\n  }\n\n  _shouldInit() {\n    return (\n      this._auth.loginStatus === loginStatus.loggedIn &&\n      (!this._storage || this._storage.ready) &&\n      this._readyCheck() &&\n      !this.ready\n    );\n  }\n\n  _shouldReset() {\n    return (\n      (\n        this._auth.loginStatus !== loginStatus.loggedIn ||\n        (this._storage && !this._storage.ready)\n      ) &&\n      this.ready\n    );\n  }\n\n  _initModuleStatus() {\n    this.store.dispatch({\n      type: this.actionTypes.initSuccess,\n    });\n  }\n\n  _clearStateCache() {\n    this.store.dispatch({\n      type: this.actionTypes.cleanUp,\n    });\n  }\n\n  _resetModuleStatus() {\n    this.store.dispatch({\n      type: this.actionTypes.resetSuccess,\n    });\n  }\n\n  addSearchSource({ sourceName, searchFn, readyCheckFn, formatFn }) {\n    if (!sourceName) {\n      throw new Error('ContactSearch: \"sourceName\" is required.');\n    }\n    if (this._searchSources.has(sourceName)) {\n      throw new Error(`ContactSearch: A search source named \"${sourceName}\" already exists`);\n    }\n    if (this._searchSourcesCheck.has(sourceName)) {\n      throw new Error(`ContactSearch: A search source check named \"${sourceName}\" already exists`);\n    }\n    if (this._searchSourcesFormat.has(sourceName)) {\n      throw new Error(`ContactSearch: A search source format named \"${sourceName}\" already exists`);\n    }\n    if (typeof searchFn !== 'function') {\n      throw new Error('ContactSearch: searchFn must be a function');\n    }\n    if (typeof readyCheckFn !== 'function') {\n      throw new Error('ContactSearch: readyCheckFn must be a function');\n    }\n    if (typeof formatFn !== 'function') {\n      throw new Error('ContactSearch: formatFn must be a function');\n    }\n    this._searchSources.set(sourceName, searchFn);\n    this._searchSourcesFormat.set(sourceName, formatFn);\n    this._searchSourcesCheck.set(sourceName, readyCheckFn);\n  }\n\n  @proxify\n  async search({ searchString }) {\n    if (!this.ready || (searchString.length < this._minimalSearchLength)) {\n      this.store.dispatch({\n        type: this.actionTypes.prepareSearch,\n      });\n      return;\n    }\n\n    if (this.searching.searchString === searchString) {\n      return;\n    }\n\n    const searchOnSources = Array.from(this._searchSources.keys());\n    for (const sourceName of searchOnSources) {\n      await this._searchSource({\n        searchOnSources,\n        sourceName,\n        searchString,\n      });\n    }\n  }\n\n  @proxify\n  async searchPlus({ sourceName, searchText, pageNumber }) {\n    if (!this.ready) {\n      this.store.dispatch({\n        type: this.actionTypes.prepareSearch,\n      });\n      return;\n    }\n\n    this.store.dispatch({\n      type: this.actionTypes.updateSearchCriteria,\n      sourceName,\n      searchText,\n      pageNumber,\n    });\n\n    clearTimeout(this._searchTimeoutId);\n    this._searchTimeoutId = setTimeout(async () => {\n      const searchOnSources = (!sourceName || sourceName === AllContactSourceName) ?\n        Array.from(this._searchSources.keys()) :\n        [sourceName];\n      for (const source of searchOnSources) {\n        await this._searchSource({\n          searchOnSources,\n          sourceName: source,\n          searchString: searchText,\n        });\n      }\n    }, 100);\n  }\n\n  @proxify\n  async _searchSource({ searchOnSources, sourceName, searchString }) {\n    this.store.dispatch({\n      type: this.actionTypes.search,\n    });\n    try {\n      let entities = null;\n      entities = this._searchFromCache({ sourceName, searchString });\n      if (entities) {\n        this._loadSearching({ searchOnSources, searchString, entities });\n        return;\n      }\n      entities = await this._searchSources.get(sourceName)({\n        searchString,\n      });\n      entities = this._searchSourcesFormat.get(sourceName)(entities);\n      this._loadSearching({ searchOnSources, searchString, entities });\n      this._saveSearching({ sourceName, searchString, entities });\n    } catch (error) {\n      this._onSearchError();\n    }\n  }\n\n  _searchFromCache({ sourceName, searchString }) {\n    const key = `${sourceName}-${searchString}`;\n    const searching = this.cache && this.cache.contactSearch && this.cache.contactSearch[key];\n    const now = Date.now();\n    if (searching && (now - searching.timestamp) < this._ttl) {\n      return searching.entities;\n    }\n    return null;\n  }\n\n  _readyCheck() {\n    for (const sourceName of this._searchSourcesCheck.keys()) {\n      if (!this._searchSourcesCheck.get(sourceName)()) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  _onSearchError() {\n    this.store.dispatch({\n      type: this.actionTypes.searchError,\n    });\n  }\n\n  _loadSearching({ searchOnSources, searchString, entities }) {\n    this.store.dispatch({\n      type: this.actionTypes.searchSuccess,\n      searchOnSources,\n      searchString,\n      entities,\n    });\n  }\n\n  _saveSearching({ sourceName, searchString, entities }) {\n    this.store.dispatch({\n      type: this.actionTypes.save,\n      sourceName,\n      searchString,\n      entities,\n      ttl: this._ttl,\n    });\n  }\n\n  get cache() {\n    return this._storage ?\n      this._storage.getItem(this._storageKey) :\n      this.state.cache;\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get searchStatus() {\n    return this.state.searchStatus;\n  }\n\n  get searching() {\n    return this.state.searching;\n  }\n\n  get searchResult() {\n    return this.searching ? this.searching.result : [];\n  }\n\n  get searchCriteria() {\n    return this.state.searchCriteria;\n  }\n\n  get contactSourceNames() {\n    return this._selectors.contactSourceNames();\n  }\n\n  get contactGroups() {\n    return this._selectors.contactGroups();\n  }\n}\n"]}