{"version":3,"sources":["modules/storage/get-storage-reducer.js"],"names":["getStorageReducer","prefix","actions","tmp","state","action","data","key","status","pending","version","error","type","init","update","dirty","remove","save","saving","saveSuccess","saved","saveError","load","reset"],"mappings":";;;;;;;;;;kBAIwBA,iB;;AAJxB;;AACA;;;;AACA;;;;;;AAEe,SAASA,iBAAT,CAA2BC,MAA3B,EAAmC;AAChD,MAAMC,UAAU,gCAAc,EAAEA,iCAAF,EAA2BD,cAA3B,EAAd,CAAhB;AACA,MAAIE,MAAM,IAAV;AACA,SAAO,UAACC,KAAD,EAAQC,MAAR,EAAmB;AACxB,QAAI,CAACD,KAAL,EAAY;AACV,aAAO;AACLE,cAAM,EADD;AAELC,aAAK,IAFA;AAGLC,gBAAQ,wBAAcC,OAHjB;AAILC,iBAAS,CAJJ;AAKLC,eAAO;AALF,OAAP;AAOD;AACD,QAAI,CAACN,MAAL,EAAa;AACX,aAAOD,KAAP;AACD;AACD,YAAQC,OAAOO,IAAf;;AAEE,WAAKV,QAAQW,IAAb;AACE,eAAO;AACLP,gBAAMD,OAAOC,IADR;AAELC,eAAKF,OAAOE,GAFP;AAGLC,kBAAQH,OAAOG,MAHV;AAILG,iBAAON,OAAOM,KAJT;AAKLD,mBAASN,MAAMM,OAAN,GAAgB;AALpB,SAAP;;AAQF,WAAKR,QAAQY,MAAb;AACE,0CACKV,KADL;AAEEE,2CACKF,MAAME,IADX,EAEKD,OAAOC,IAFZ,CAFF;AAMEI,mBAASN,MAAMM,OAAN,GAAgB,CAN3B;AAOEF,kBAAQ,wBAAcO;AAPxB;;AAUF,WAAKb,QAAQc,MAAb;AACEb,yCACKC,MAAME,IADX;AAGA,eAAOH,IAAIE,OAAOE,GAAX,CAAP;AACA,0CACKH,KADL;AAEEE,gBAAMH,GAFR;AAGEO,mBAASN,MAAMM,OAAN,GAAgB,CAH3B;AAIEF,kBAAQ,wBAAcO;AAJxB;;AAOF,WAAKb,QAAQe,IAAb;AACE,0CACKb,KADL;AAEEI,kBAAQ,wBAAcU;AAFxB;;AAKF,WAAKhB,QAAQiB,WAAb;AACE,eAAOd,OAAOK,OAAP,KAAmBN,MAAMM,OAAzB,8BAEAN,KAFA;AAGHI,kBAAQ,wBAAcY;AAHnB,aAKLhB,KALF;;AAOF,WAAKF,QAAQmB,SAAb;AACE,eAAOhB,OAAOK,OAAP,KAAmBN,MAAMM,OAAzB,8BAEAN,KAFA;AAGHI,kBAAQ,wBAAcO,KAHnB;AAIHJ,iBAAON,OAAOM;AAJX,aAMLP,KANF;;AAQF,WAAKF,QAAQoB,IAAb;AACE,0CACKlB,KADL;AAEEE,gBAAMD,OAAOC,IAFf;AAGEE,kBAAQ,wBAAcY,KAHxB;AAIEV,mBAASN,MAAMM,OAAN,GAAgB,CAJ3B;AAKEC,iBAAO;AALT;;AAQF,WAAKT,QAAQqB,KAAb;AACE,eAAO;AACLf,kBAAQ,wBAAcC,OADjB;AAELH,gBAAM,EAFD;AAGLC,eAAK,IAHA;AAILG,mBAASN,MAAMM,OAAN,GAAgB,CAJpB;AAKLC,iBAAO;AALF,SAAP;;AAQF;AACE,eAAOP,KAAP;AA5EJ;AA8ED,GA3FD;AA4FD","file":"get-storage-reducer.js","sourcesContent":["import { prefixActions } from '../../lib/redux-helper';\nimport storageActions from './storage-actions';\nimport storageStatus from './storage-status';\n\nexport default function getStorageReducer(prefix) {\n  const actions = prefixActions({ actions: storageActions, prefix });\n  let tmp = null;\n  return (state, action) => {\n    if (!state) {\n      return {\n        data: {},\n        key: null,\n        status: storageStatus.pending,\n        version: 0,\n        error: null,\n      };\n    }\n    if (!action) {\n      return state;\n    }\n    switch (action.type) {\n\n      case actions.init:\n        return {\n          data: action.data,\n          key: action.key,\n          status: action.status,\n          error: action.error,\n          version: state.version + 1,\n        };\n\n      case actions.update:\n        return {\n          ...state,\n          data: {\n            ...state.data,\n            ...action.data,\n          },\n          version: state.version + 1,\n          status: storageStatus.dirty,\n        };\n\n      case actions.remove:\n        tmp = {\n          ...state.data,\n        };\n        delete tmp[action.key];\n        return {\n          ...state,\n          data: tmp,\n          version: state.version + 1,\n          status: storageStatus.dirty,\n        };\n\n      case actions.save:\n        return {\n          ...state,\n          status: storageStatus.saving,\n        };\n\n      case actions.saveSuccess:\n        return action.version === state.version ?\n          {\n            ...state,\n            status: storageStatus.saved,\n          } :\n          state;\n\n      case actions.saveError:\n        return action.version === state.version ?\n          {\n            ...state,\n            status: storageStatus.dirty,\n            error: action.error,\n          } :\n          state;\n\n      case actions.load:\n        return {\n          ...state,\n          data: action.data,\n          status: storageStatus.saved,\n          version: state.version + 1,\n          error: null,\n        };\n\n      case actions.reset:\n        return {\n          status: storageStatus.pending,\n          data: {},\n          key: null,\n          version: state.version + 1,\n          error: null,\n        };\n\n      default:\n        return state;\n    }\n  };\n}\n"]}