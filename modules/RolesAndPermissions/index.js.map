{"version":3,"sources":["/src/modules/RolesAndPermissions/index.js"],"names":["DEFAULT_TTL","extractData","permissions","output","forEach","item","permission","id","RolesAndPermissions","client","extensionInfo","ttl","options","name","fetchFunction","_client","account","extension","authzProfile","get","_extensionInfo","addSelector","data","store","subscribe","_auth","loggedIn","_storage","ready","status","pending","dispatch","type","actionTypes","init","_tabManager","active","isFreshLogin","timestamp","Date","now","_ttl","fetchData","_retry","initSuccess","_clearTimeout","_promise","resetSuccess","serviceFeatures","_selectors","RingOut","enabled"],"mappings":"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","file":"index.js","sourcesContent":["import DataFetcher from '../../lib/DataFetcher';\nimport moduleStatus from '../../enums/moduleStatus';\n\nconst DEFAULT_TTL = 24 * 60 * 60 * 1000;\n\nfunction extractData(permissions) {\n  const output = {};\n  permissions.permissions.forEach(item => {\n    output[item.permission.id] = true;\n  });\n  return output;\n}\n\nexport default class RolesAndPermissions extends DataFetcher {\n  constructor({\n    client,\n    extensionInfo,\n    ttl = DEFAULT_TTL,\n    ...options\n  }) {\n    super({\n      name: 'rolesAndPermissions',\n      client,\n      ttl,\n      fetchFunction: async () => extractData(\n        await this._client.account().extension().authzProfile().get()\n      ),\n      ...options\n    });\n    this._extensionInfo = extensionInfo;\n    this.addSelector(\n      'permissions',\n      () => this.data,\n      data => data || {},\n    );\n  }\n  initialize() {\n    this.store.subscribe(async () => {\n      if (\n        this._auth.loggedIn &&\n        this._storage.ready &&\n        this._extensionInfo.ready &&\n        this.status === moduleStatus.pending\n      ) {\n        this.store.dispatch({\n          type: this.actionTypes.init,\n        });\n        if (\n          (!this._tabManager || this._tabManager.active) &&\n          (\n            this._auth.isFreshLogin ||\n            !this.timestamp ||\n            Date.now() - this.timestamp > this._ttl\n          )\n        ) {\n          await this.fetchData();\n        } else {\n          this._retry();\n        }\n        this.store.dispatch({\n          type: this.actionTypes.initSuccess,\n        });\n      } else if (\n        (!this._auth.loggedIn || !this._storage.ready || !this._extensionInfo.ready) &&\n        this.ready\n      ) {\n        this._clearTimeout();\n        this._promise = null;\n        this.store.dispatch({\n          type: this.actionTypes.resetSuccess,\n        });\n      }\n    });\n  }\n\n  get serviceFeatures() {\n    return this._extensionInfo.serviceFeatures;\n  }\n\n  get permissions() {\n    return this._selectors.permissions();\n  }\n\n  get ringoutEnabled() {\n    return this._extensionInfo.serviceFeatures &&\n    this._extensionInfo.serviceFeatures.RingOut &&\n    this._extensionInfo.serviceFeatures.RingOut.enabled;\n  }\n\n}\n"]}