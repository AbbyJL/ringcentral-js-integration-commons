{"version":3,"sources":["lib/RcModule.js"],"names":["addModule","initFunction","suppressInit","initializeModule","symbols","defaultReducer","state","defaultGetState","store","getState","RcModule","options","prefix","actions","Error","modulePath","name","module","Object","prototype","hasOwnProperty","get","enumerable","property","descriptor","value","proto","proxyFunction","toString","configurable","setStore","subscribe","oldState","newState","emit","subModule","callInit","isInitialized"],"mappings":"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","file":"RcModule.js","sourcesContent":["import SymbolMap from 'data-types/symbol-map';\nimport { prefixActions } from './ActionMap';\nimport Emitter from './Emitter';\n\nconst symbols = new SymbolMap([\n  'store',\n  'getState',\n  'prefix',\n  'actions',\n  'emitter',\n  'modulePath',\n  'oldState',\n  'initFunction',\n  'isInitialized',\n  'suppressInit',\n]);\n\n/**\n * @function\n * @param {Object} state\n * @return {Object}\n * @description Default reducer if module does not has its own reducer.\n */\nfunction defaultReducer(state) {\n  if (typeof state === 'undefined') return {};\n  return state;\n}\n\nfunction defaultGetState() {\n  return this.store.getState();\n}\n\n/**\n * @class\n * @default\n * @description Base module class.\n */\nexport default class RcModule extends Emitter {\n  /**\n   * @constructor\n   */\n  constructor(options = {}) {\n    super();\n    const {\n      getState = defaultGetState,\n      prefix,\n      actions,\n    } = options;\n    if (typeof getState !== 'function') {\n      throw new Error(\n        'The `getState` options property must be of type function'\n      );\n    }\n    this[symbols.getState] = getState;\n    if (prefix && typeof prefix !== 'string') {\n      throw new Error('The `prefix` options property must be null, undefined, or a string');\n    }\n    this[symbols.prefix] = prefix;\n    this[symbols.actions] = actions && prefixActions({ actions, prefix });\n  }\n\n  get state() {\n    return this::this[symbols.getState]();\n  }\n  get reducer() {\n    return defaultReducer;\n  }\n  get store() {\n    if (!this[symbols.store]) {\n      throw new Error('module has not been initialized...');\n    }\n    return this[symbols.store];\n  }\n  get prefix() {\n    return this[symbols.prefix];\n  }\n  get actions() {\n    return this[symbols.actions];\n  }\n  get modulePath() {\n    return this[symbols.modulePath] || 'root';\n  }\n}\n\n/**\n * @function addModule\n * @param {String} name - Name of the module. Also used for the property name.\n * @param {any} module - The module to be attached, can be any type.\n * @description Intended to be used as an instance function. Either use\n *  the bind operator (target::addModule('testmodule', {})), or\n *  use call/apply (addModule.call(target, 'testmodule', {})).\n */\nexport function addModule(name, module) {\n  if (!this || !(this instanceof RcModule)) {\n    throw new Error('addModule should be called with scope binding to target module');\n  }\n  if (this::Object.prototype.hasOwnProperty(name)) {\n    throw new Error(`module '${name}' already exists...`);\n  }\n  Object.defineProperty(this, name, {\n    get() {\n      return module;\n    },\n    enumerable: true,\n  });\n\n  // tag submodule with a modulePath for proxying function calls\n  // do nothing if module is already tagged\n  if (!this[name][symbols.modulePath]) {\n    this[name][symbols.modulePath] = `${this.modulePath}.${name}`;\n  }\n}\n\n/**\n * @function\n * @decorator\n * @param {Object} prototype\n * @param {String} property\n * @param {Object} descriptor\n * @description Decorator function to decorate initialize functions for RcModules\n */\nexport function initFunction(prototype, property, descriptor) {\n  const {\n    value,\n  } = descriptor;\n  if (typeof value !== 'function') {\n    throw new Error('initFunction must be a function');\n  }\n  const proto = prototype;\n  proto[symbols.initFunction] = value;\n\n  function proxyFunction() {\n    throw new Error('initFunction cannot be called directly');\n  }\n  // eslint-disable-next-line\n  proxyFunction.toString = () => value.toString();\n\n  return {\n    enumerable: true,\n    configurable: false,\n    get() {\n      return proxyFunction;\n    },\n  };\n}\n\n/**\n * @function\n * @description Helper function used to suppress the call of initFunction\n */\nexport function suppressInit() {\n  this[symbols.suppressInit] = true;\n}\n\n\nfunction setStore(store) {\n  if (!this[symbols.store]) {\n    this[symbols.store] = store;\n\n    // state change event for state tracking\n    store.subscribe(() => {\n      const oldState = this[symbols.oldState];\n      const newState = this.state;\n      if (newState !== oldState) {\n        this[symbols.oldState] = newState;\n        this.emit('state-change', {\n          oldState,\n          newState,\n        });\n      }\n    });\n    for (const subModule in this) {\n      if (this.hasOwnProperty(subModule) && this[subModule] instanceof RcModule) {\n        this[subModule]::setStore(store);\n      }\n    }\n  }\n}\n\nfunction callInit() {\n  if (\n    !this[symbols.suppressInit] &&\n    !this[symbols.isInitialized] &&\n    typeof this[symbols.initFunction] === 'function'\n  ) {\n    this[symbols.isInitialized] = true;\n    this[symbols.initFunction]();\n  }\n  for (const subModule in this) {\n    if (this.hasOwnProperty(subModule) && this[subModule] instanceof RcModule) {\n      this[subModule]::callInit();\n    }\n  }\n}\n\nexport function initializeModule(store) {\n  if (!(this instanceof RcModule)) {\n    throw new Error('initializeModule should be scope-bound to a RcModule instance');\n  }\n  if (this[symbols.store]) {\n    throw new Error('Module has already been initialized');\n  }\n  this::setStore(store);\n  this::callInit();\n}\n"]}